import _extends from "@babel/runtime/helpers/extends";
import _objectSpread from "@babel/runtime/helpers/objectSpread2";
import React, { Fragment, useContext } from 'react';
import { EditorContext } from '../../Context';
import Child from './Child';
import "./index.css";
export default function Toolbar() {
  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var prefixCls = props.prefixCls,
      _props$height = props.height,
      height = _props$height === void 0 ? 29 : _props$height;

  var _useContext = useContext(EditorContext),
      commands = _useContext.commands,
      fullscreen = _useContext.fullscreen,
      preview = _useContext.preview,
      _useContext$barPopup = _useContext.barPopup,
      barPopup = _useContext$barPopup === void 0 ? {} : _useContext$barPopup,
      commandOrchestrator = _useContext.commandOrchestrator,
      dispatch = _useContext.dispatch;

  function handleClick(command, name) {
    if (!dispatch) return;
    var state = {
      barPopup: _objectSpread({}, barPopup)
    };

    if (command.keyCommand === 'preview') {
      state.preview = command.value;
    }

    if (command.keyCommand === 'fullscreen') {
      state.fullscreen = !fullscreen;
      document.body.style.overflow = fullscreen ? 'initial' : 'hidden';
    }

    if (commands && command.keyCommand === 'group') {
      commands.forEach(function (item) {
        if (name === item.groupName) {
          state.barPopup[name] = true;
        } else if (item.keyCommand) {
          state.barPopup[item.groupName] = false;
        }
      });
    } else if (name || command.parent) {
      Object.keys(state.barPopup || {}).forEach(function (keyName) {
        state.barPopup[keyName] = false;
      });
    }

    if (Object.keys(state).length) {
      dispatch(_objectSpread({}, state));
    }

    commandOrchestrator && commandOrchestrator.executeCommand(command);
  }

  return /*#__PURE__*/React.createElement("div", {
    className: "".concat(prefixCls, "-toolbar"),
    style: {
      height: height
    }
  }, /*#__PURE__*/React.createElement("ul", null, (props.commands || commands || []).map(function (item, idx) {
    if (item.keyCommand === 'divider') {
      return /*#__PURE__*/React.createElement("li", _extends({
        key: idx
      }, item.liProps, {
        className: "".concat(prefixCls, "-toolbar-divider")
      }));
    }

    if (!item.keyCommand) return /*#__PURE__*/React.createElement(Fragment, null);
    var activeBtn = fullscreen && item.keyCommand === 'fullscreen' || item.keyCommand === 'preview' && preview === item.value;
    var childNode = typeof item.children === 'function' ? item.children({
      getState: function getState() {
        return commandOrchestrator.getState();
      },
      textApi: commandOrchestrator ? commandOrchestrator.textApi : undefined,
      close: function close() {
        return handleClick({}, item.groupName);
      },
      execute: function execute() {
        return handleClick({
          execute: item.execute
        });
      }
    }) : undefined;
    var disabled = barPopup && preview && preview === 'preview' && !/(preview|fullscreen)/.test(item.keyCommand);
    return /*#__PURE__*/React.createElement("li", _extends({
      key: idx
    }, item.liProps, {
      className: activeBtn ? "active" : ''
    }), !item.buttonProps && item.icon, item.buttonProps && /*#__PURE__*/React.createElement('button', _objectSpread(_objectSpread({
      type: 'button',
      disabled: disabled,
      'data-name': item.name
    }, item.buttonProps), {}, {
      onClick: function onClick(evn) {
        evn.stopPropagation();
        handleClick(item, item.groupName);
      }
    }), item.icon), item.children && /*#__PURE__*/React.createElement(Child, {
      groupName: item.groupName,
      prefixCls: prefixCls,
      children: childNode,
      commands: Array.isArray(item.children) && typeof item.children !== 'function' ? item.children : undefined
    }));
  })));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1Rvb2xiYXIvaW5kZXgudHN4Il0sIm5hbWVzIjpbIlJlYWN0IiwiRnJhZ21lbnQiLCJ1c2VDb250ZXh0IiwiRWRpdG9yQ29udGV4dCIsIkNoaWxkIiwiVG9vbGJhciIsInByb3BzIiwicHJlZml4Q2xzIiwiaGVpZ2h0IiwiY29tbWFuZHMiLCJmdWxsc2NyZWVuIiwicHJldmlldyIsImJhclBvcHVwIiwiY29tbWFuZE9yY2hlc3RyYXRvciIsImRpc3BhdGNoIiwiaGFuZGxlQ2xpY2siLCJjb21tYW5kIiwibmFtZSIsInN0YXRlIiwia2V5Q29tbWFuZCIsInZhbHVlIiwiZG9jdW1lbnQiLCJib2R5Iiwic3R5bGUiLCJvdmVyZmxvdyIsImZvckVhY2giLCJpdGVtIiwiZ3JvdXBOYW1lIiwicGFyZW50IiwiT2JqZWN0Iiwia2V5cyIsImtleU5hbWUiLCJsZW5ndGgiLCJleGVjdXRlQ29tbWFuZCIsIm1hcCIsImlkeCIsImxpUHJvcHMiLCJhY3RpdmVCdG4iLCJjaGlsZE5vZGUiLCJjaGlsZHJlbiIsImdldFN0YXRlIiwidGV4dEFwaSIsInVuZGVmaW5lZCIsImNsb3NlIiwiZXhlY3V0ZSIsImRpc2FibGVkIiwidGVzdCIsImJ1dHRvblByb3BzIiwiaWNvbiIsImNyZWF0ZUVsZW1lbnQiLCJ0eXBlIiwib25DbGljayIsImV2biIsInN0b3BQcm9wYWdhdGlvbiIsIkFycmF5IiwiaXNBcnJheSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPQSxLQUFQLElBQWdCQyxRQUFoQixFQUEwQkMsVUFBMUIsUUFBNEMsT0FBNUM7QUFFQSxTQUFTQyxhQUFULFFBQXlELGVBQXpEO0FBRUEsT0FBT0MsS0FBUCxNQUFrQixTQUFsQjtBQUNBO0FBUUEsZUFBZSxTQUFTQyxPQUFULEdBQTRDO0FBQUEsTUFBM0JDLEtBQTJCLHVFQUFKLEVBQUk7QUFDekQsTUFBUUMsU0FBUixHQUFtQ0QsS0FBbkMsQ0FBUUMsU0FBUjtBQUFBLHNCQUFt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LElBRDdCLEVBRUd0QixJQUFJLENBQUNxQixXQUFMLGlCQUNDL0MsS0FBSyxDQUFDaUQsYUFBTixDQUNFLFFBREY7QUFHSUMsTUFBQUEsSUFBSSxFQUFFLFFBSFY7QUFJSUwsTUFBQUEsUUFBUSxFQUFSQSxRQUpKO0FBS0ksbUJBQWFuQixJQUFJLENBQUNUO0FBTHRCLE9BTU9TLElBQUksQ0FBQ3FCLFdBTlo7QUFPSUksTUFBQUEsT0FBTyxFQUFFLGlCQUFDQyxHQUFELEVBQTBEO0FBQ2pFQSxRQUFBQSxHQUFHLENBQUNDLGVBQUo7QUFDQXRDLFFBQUFBLFdBQVcsQ0FBQ1csSUFBRCxFQUFPQSxJQUFJLENBQUNDLFNBQVosQ0FBWDtBQUNEO0FBVkwsUUFZRUQsSUFBSSxDQUFDc0IsSUFaUCxDQUhKLEVBaUJHdEIsSUFBSSxDQUFDYSxRQUFMLGlCQUNDLG9CQUFDLEtBQUQ7QUFDRSxNQUFBLFNBQVMsRUFBRWIsSUFBSSxDQUFDQyxTQURsQjtBQUVFLE1BQUEsU0FBUyxFQUFFcEIsU0FGYjtBQUdFLE1BQUEsUUFBUSxFQUFFK0IsU0FIWjtBQUlFLE1BQUEsUUFBUSxFQUNOZ0IsS0FBSyxDQUFDQyxPQUFOLENBQWM3QixJQUFJLENBQUNhLFFBQW5CLEtBQWdDLE9BQU9iLElBQUksQ0FBQ2EsUUFBWixLQUF5QixVQUF6RCxHQUFzRWIsSUFBSSxDQUFDYSxRQUEzRSxHQUFzRkc7QUFMMUYsTUFsQkosQ0FERjtBQThCRCxHQWpEQSxDQURILENBREYsQ0FERjtBQXdERCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBGcmFnbWVudCwgdXNlQ29udGV4dCB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgSVByb3BzIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xyXG5pbXBvcnQgeyBFZGl0b3JDb250ZXh0LCBQcmV2aWV3VHlwZSwgQ29udGV4dFN0b3JlIH0gZnJvbSAnLi4vLi4vQ29udGV4dCc7XHJcbmltcG9ydCB7IElDb21tYW5kIH0gZnJvbSAnLi4vLi4vY29tbWFuZHMnO1xyXG5pbXBvcnQgQ2hpbGQgZnJvbSAnLi9DaGlsZCc7XHJcbmltcG9ydCAnLi9pbmRleC5sZXNzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVRvb2xiYXJQcm9wcyBleHRlbmRzIElQcm9wcyB7XHJcbiAgaGVpZ2h0PzogUmVhY3QuQ1NTUHJvcGVydGllc1snaGVpZ2h0J107XHJcbiAgb25Db21tYW5kPzogKGNvbW1hbmQ6IElDb21tYW5kPHN0cmluZz4sIGdyb3VwTmFtZT86IHN0cmluZykgPT4gdm9pZDtcclxuICBjb21tYW5kcz86IElDb21tYW5kPHN0cmluZz5bXTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gVG9vbGJhcihwcm9wczogSVRvb2xiYXJQcm9wcyA9IHt9KSB7XHJcbiAgY29uc3QgeyBwcmVmaXhDbHMsIGhlaWdodCA9IDI5IH0gPSBwcm9wcztcclxuICBjb25zdCB7IGNvbW1hbmRzLCBmdWxsc2NyZWVuLCBwcmV2aWV3LCBiYXJQb3B1cCA9IHt9LCBjb21tYW5kT3JjaGVzdHJhdG9yLCBkaXNwYXRjaCB9ID0gdXNlQ29udGV4dChFZGl0b3JDb250ZXh0KTtcclxuICBmdW5jdGlvbiBoYW5kbGVDbGljayhjb21tYW5kOiBJQ29tbWFuZDxzdHJpbmc+LCBuYW1lPzogc3RyaW5nKSB7XHJcbiAgICBpZiAoIWRpc3BhdGNoKSByZXR1cm47XHJcbiAgICBjb25zdCBzdGF0ZTogQ29udGV4dFN0b3JlID0geyBiYXJQb3B1cDogeyAuLi5iYXJQb3B1cCB9IH07XHJcbiAgICBpZiAoY29tbWFuZC5rZXlDb21tYW5kID09PSAncHJldmlldycpIHtcclxuICAgICAgc3RhdGUucHJldmlldyA9IGNvbW1hbmQudmFsdWUgYXMgUHJldmlld1R5cGU7XHJcbiAgICB9XHJcbiAgICBpZiAoY29tbWFuZC5rZXlDb21tYW5kID09PSAnZnVsbHNjcmVlbicpIHtcclxuICAgICAgc3RhdGUuZnVsbHNjcmVlbiA9ICFmdWxsc2NyZWVuO1xyXG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gZnVsbHNjcmVlbiA/ICdpbml0aWFsJyA6ICdoaWRkZW4nO1xyXG4gICAgfVxyXG4gICAgaWYgKGNvbW1hbmRzICYmIGNvbW1hbmQua2V5Q29tbWFuZCA9PT0gJ2dyb3VwJykge1xyXG4gICAgICBjb21tYW5kcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgaWYgKG5hbWUgPT09IGl0ZW0uZ3JvdXBOYW1lKSB7XHJcbiAgICAgICAgICBzdGF0ZS5iYXJQb3B1cCFbbmFtZSFdID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0ua2V5Q29tbWFuZCkge1xyXG4gICAgICAgICAgc3RhdGUuYmFyUG9wdXAhW2l0ZW0uZ3JvdXBOYW1lIV0gPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIGlmIChuYW1lIHx8IGNvbW1hbmQucGFyZW50KSB7XHJcbiAgICAgIE9iamVjdC5rZXlzKHN0YXRlLmJhclBvcHVwIHx8IHt9KS5mb3JFYWNoKChrZXlOYW1lKSA9PiB7XHJcbiAgICAgICAgc3RhdGUuYmFyUG9wdXAhW2tleU5hbWVdID0gZmFsc2U7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChPYmplY3Qua2V5cyhzdGF0ZSkubGVuZ3RoKSB7XHJcbiAgICAgIGRpc3BhdGNoKHsgLi4uc3RhdGUgfSk7XHJcbiAgICB9XHJcbiAgICBjb21tYW5kT3JjaGVzdHJhdG9yICYmIGNvbW1hbmRPcmNoZXN0cmF0b3IuZXhlY3V0ZUNvbW1hbmQoY29tbWFuZCk7XHJcbiAgfVxyXG4gIHJldHVybiAoXHJcbiAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10b29sYmFyYH0gc3R5bGU9e3sgaGVpZ2h0IH19PlxyXG4gICAgICA8dWw+XHJcbiAgICAgICAgeyhwcm9wcy5jb21tYW5kcyB8fCBjb21tYW5kcyB8fCBbXSkubWFwKChpdGVtLCBpZHgpID0+IHtcclxuICAgICAgICAgIGlmIChpdGVtLmtleUNvbW1hbmQgPT09ICdkaXZpZGVyJykge1xyXG4gICAgICAgICAgICByZXR1cm4gPGxpIGtleT17aWR4fSB7Li4uaXRlbS5saVByb3BzfSBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdG9vbGJhci1kaXZpZGVyYH0gLz47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoIWl0ZW0ua2V5Q29tbWFuZCkgcmV0dXJuIDxGcmFnbWVudCAvPjtcclxuICAgICAgICAgIGNvbnN0IGFjdGl2ZUJ0biA9XHJcbiAgICAgICAgICAgIChmdWxsc2NyZWVuICYmIGl0ZW0ua2V5Q29tbWFuZCA9PT0gJ2Z1bGxzY3JlZW4nKSB8fFxyXG4gICAgICAgICAgICAoaXRlbS5rZXlDb21tYW5kID09PSAncHJldmlldycgJiYgcHJldmlldyA9PT0gaXRlbS52YWx1ZSk7XHJcbiAgICAgICAgICBjb25zdCBjaGlsZE5vZGUgPVxyXG4gICAgICAgICAgICB0eXBlb2YgaXRlbS5jaGlsZHJlbiA9PT0gJ2Z1bmN0aW9uJ1xyXG4gICAgICAgICAgICAgID8gaXRlbS5jaGlsZHJlbih7XHJcbiAgICAgICAgICAgICAgICAgIGdldFN0YXRlOiAoKSA9PiBjb21tYW5kT3JjaGVzdHJhdG9yIS5nZXRTdGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAgICB0ZXh0QXBpOiBjb21tYW5kT3JjaGVzdHJhdG9yID8gY29tbWFuZE9yY2hlc3RyYXRvciEudGV4dEFwaSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgICAgY2xvc2U6ICgpID0+IGhhbmRsZUNsaWNrKHt9LCBpdGVtLmdyb3VwTmFtZSksXHJcbiAgICAgICAgICAgICAgICAgIGV4ZWN1dGU6ICgpID0+IGhhbmRsZUNsaWNrKHsgZXhlY3V0ZTogaXRlbS5leGVjdXRlIH0pLFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcclxuICAgICAgICAgIGNvbnN0IGRpc2FibGVkID1cclxuICAgICAgICAgICAgYmFyUG9wdXAgJiYgcHJldmlldyAmJiBwcmV2aWV3ID09PSAncHJldmlldycgJiYgIS8ocHJldmlld3xmdWxsc2NyZWVuKS8udGVzdChpdGVtLmtleUNvbW1hbmQpO1xyXG4gICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPGxpIGtleT17aWR4fSB7Li4uaXRlbS5saVByb3BzfSBjbGFzc05hbWU9e2FjdGl2ZUJ0biA/IGBhY3RpdmVgIDogJyd9PlxyXG4gICAgICAgICAgICAgIHshaXRlbS5idXR0b25Qcm9wcyAmJiBpdGVtLmljb259XHJcbiAgICAgICAgICAgICAge2l0ZW0uYnV0dG9uUHJvcHMgJiZcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXHJcbiAgICAgICAgICAgICAgICAgICdidXR0b24nLFxyXG4gICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2RhdGEtbmFtZSc6IGl0ZW0ubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAuLi5pdGVtLmJ1dHRvblByb3BzLFxyXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IChldm46IFJlYWN0Lk1vdXNlRXZlbnQ8SFRNTEJ1dHRvbkVsZW1lbnQsIE1vdXNlRXZlbnQ+KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBldm4uc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVDbGljayhpdGVtLCBpdGVtLmdyb3VwTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgaXRlbS5pY29uLFxyXG4gICAgICAgICAgICAgICAgKX1cclxuICAgICAgICAgICAgICB7aXRlbS5jaGlsZHJlbiAmJiAoXHJcbiAgICAgICAgICAgICAgICA8Q2hpbGRcclxuICAgICAgICAgICAgICAgICAgZ3JvdXBOYW1lPXtpdGVtLmdyb3VwTmFtZX1cclxuICAgICAgICAgICAgICAgICAgcHJlZml4Q2xzPXtwcmVmaXhDbHN9XHJcbiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuPXtjaGlsZE5vZGV9XHJcbiAgICAgICAgICAgICAgICAgIGNvbW1hbmRzPXtcclxuICAgICAgICAgICAgICAgICAgICBBcnJheS5pc0FycmF5KGl0ZW0uY2hpbGRyZW4pICYmIHR5cGVvZiBpdGVtLmNoaWxkcmVuICE9PSAnZnVuY3Rpb24nID8gaXRlbS5jaGlsZHJlbiA6IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICl9XHJcbiAgICAgICAgICAgIDwvbGk+XHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0pfVxyXG4gICAgICA8L3VsPlxyXG4gICAgPC9kaXY+XHJcbiAgKTtcclxufVxyXG4iXX0=