"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Toolbar;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _react = _interopRequireWildcard(require("react"));

var _Context = require("../../Context");

var _Child = _interopRequireDefault(require("./Child"));

function Toolbar() {
  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var prefixCls = props.prefixCls,
      _props$height = props.height,
      height = _props$height === void 0 ? 29 : _props$height;

  var _useContext = (0, _react.useContext)(_Context.EditorContext),
      commands = _useContext.commands,
      fullscreen = _useContext.fullscreen,
      preview = _useContext.preview,
      _useContext$barPopup = _useContext.barPopup,
      barPopup = _useContext$barPopup === void 0 ? {} : _useContext$barPopup,
      commandOrchestrator = _useContext.commandOrchestrator,
      dispatch = _useContext.dispatch;

  function handleClick(command, name) {
    if (!dispatch) return;
    var state = {
      barPopup: (0, _objectSpread2.default)({}, barPopup)
    };

    if (command.keyCommand === 'preview') {
      state.preview = command.value;
    }

    if (command.keyCommand === 'fullscreen') {
      state.fullscreen = !fullscreen;
      document.body.style.overflow = fullscreen ? 'initial' : 'hidden';
    }

    if (commands && command.keyCommand === 'group') {
      commands.forEach(function (item) {
        if (name === item.groupName) {
          state.barPopup[name] = true;
        } else if (item.keyCommand) {
          state.barPopup[item.groupName] = false;
        }
      });
    } else if (name || command.parent) {
      Object.keys(state.barPopup || {}).forEach(function (keyName) {
        state.barPopup[keyName] = false;
      });
    }

    if (Object.keys(state).length) {
      dispatch((0, _objectSpread2.default)({}, state));
    }

    commandOrchestrator && commandOrchestrator.executeCommand(command);
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: "".concat(prefixCls, "-toolbar"),
    style: {
      height: height
    }
  }, /*#__PURE__*/_react.default.createElement("ul", null, (props.commands || commands || []).map(function (item, idx) {
    if (item.keyCommand === 'divider') {
      return /*#__PURE__*/_react.default.createElement("li", (0, _extends2.default)({
        key: idx
      }, item.liProps, {
        className: "".concat(prefixCls, "-toolbar-divider")
      }));
    }

    if (!item.keyCommand) return /*#__PURE__*/_react.default.createElement(_react.Fragment, null);
    var activeBtn = fullscreen && item.keyCommand === 'fullscreen' || item.keyCommand === 'preview' && preview === item.value;
    var childNode = typeof item.children === 'function' ? item.children({
      getState: function getState() {
        return commandOrchestrator.getState();
      },
      textApi: commandOrchestrator ? commandOrchestrator.textApi : undefined,
      close: function close() {
        return handleClick({}, item.groupName);
      },
      execute: function execute() {
        return handleClick({
          execute: item.execute
        });
      }
    }) : undefined;
    var disabled = barPopup && preview && preview === 'preview' && !/(preview|fullscreen)/.test(item.keyCommand);
    return /*#__PURE__*/_react.default.createElement("li", (0, _extends2.default)({
      key: idx
    }, item.liProps, {
      className: activeBtn ? "active" : ''
    }), !item.buttonProps && item.icon, item.buttonProps && /*#__PURE__*/_react.default.createElement('button', (0, _objectSpread2.default)((0, _objectSpread2.default)({
      type: 'button',
      disabled: disabled,
      'data-name': item.name
    }, item.buttonProps), {}, {
      onClick: function onClick(evn) {
        evn.stopPropagation();
        handleClick(item, item.groupName);
      }
    }), item.icon), item.children && /*#__PURE__*/_react.default.createElement(_Child.default, {
      groupName: item.groupName,
      prefixCls: prefixCls,
      children: childNode,
      commands: Array.isArray(item.children) && typeof item.children !== 'function' ? item.children : undefined
    }));
  })));
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1Rvb2xiYXIvaW5kZXgudHN4Il0sIm5hbWVzIjpbIlRvb2xiYXIiLCJwcm9wcyIsInByZWZpeENscyIsImhlaWdodCIsIkVkaXRvckNvbnRleHQiLCJjb21tYW5kcyIsImZ1bGxzY3JlZW4iLCJwcmV2aWV3IiwiYmFyUG9wdXAiLCJjb21tYW5kT3JjaGVzdHJhdG9yIiwiZGlzcGF0Y2giLCJoYW5kbGVDbGljayIsImNvbW1hbmQiLCJuYW1lIiwic3RhdGUiLCJrZXlDb21tYW5kIiwidmFsdWUiLCJkb2N1bWVudCIsImJvZHkiLCJzdHlsZSIsIm92ZXJmbG93IiwiZm9yRWFjaCIsIml0ZW0iLCJncm91cE5hbWUiLCJwYXJlbnQiLCJPYmplY3QiLCJrZXlzIiwia2V5TmFtZSIsImxlbmd0aCIsImV4ZWN1dGVDb21tYW5kIiwibWFwIiwiaWR4IiwibGlQcm9wcyIsImFjdGl2ZUJ0biIsImNoaWxkTm9kZSIsImNoaWxkcmVuIiwiZ2V0U3RhdGUiLCJ0ZXh0QXBpIiwidW5kZWZpbmVkIiwiY2xvc2UiLCJleGVjdXRlIiwiZGlzYWJsZWQiLCJ0ZXN0IiwiYnV0dG9uUHJvcHMiLCJpY29uIiwiUmVhY3QiLCJjcmVhdGVFbGVtZW50IiwidHlwZSIsIm9uQ2xpY2siLCJldm4iLCJzdG9wUHJvcGFnYXRpb24iLCJBcnJheSIsImlzQXJyYXkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUVBOztBQVNlLFNBQVNBLE9BQVQsR0FBNEM7QUFBQSxNQUEzQkMsS0FBMkIsdUVBQUosRUFBSTtBQUN6RCxNQUFRQyxTQUFSLEdBQW1DRCxLQUFuQyxDQUFRQyxTQUFSO0FBQUEsc0JBQW1DRCxLQUFuQyxDQUFtQkUsTUFBbkI7QUFBQSxNQUFtQkEsTUFBbkIsOEJBQTRCLEVBQTVCOztBQUNBLG9CQUF3Rix1QkFBV0Msc0JBQVgsQ0FBeEY7QUFBQSxNQUFRQyxRQUFSLGVBQVFBLFFBQVI7QUFBQSxNQUFr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QixJQUFJLENBQUNUO0FBTHRCLE9BTU9TLElBQUksQ0FBQ3FCLFdBTlo7QUFPSUssTUFBQUEsT0FBTyxFQUFFLGlCQUFDQyxHQUFELEVBQTBEO0FBQ2pFQSxRQUFBQSxHQUFHLENBQUNDLGVBQUo7QUFDQXZDLFFBQUFBLFdBQVcsQ0FBQ1csSUFBRCxFQUFPQSxJQUFJLENBQUNDLFNBQVosQ0FBWDtBQUNEO0FBVkwsUUFZRUQsSUFBSSxDQUFDc0IsSUFaUCxDQUhKLEVBaUJHdEIsSUFBSSxDQUFDYSxRQUFMLGlCQUNDLDZCQUFDLGNBQUQ7QUFDRSxNQUFBLFNBQVMsRUFBRWIsSUFBSSxDQUFDQyxTQURsQjtBQUVFLE1BQUEsU0FBUyxFQUFFckIsU0FGYjtBQUdFLE1BQUEsUUFBUSxFQUFFZ0MsU0FIWjtBQUlFLE1BQUEsUUFBUSxFQUNOaUIsS0FBSyxDQUFDQyxPQUFOLENBQWM5QixJQUFJLENBQUNhLFFBQW5CLEtBQWdDLE9BQU9iLElBQUksQ0FBQ2EsUUFBWixLQUF5QixVQUF6RCxHQUFzRWIsSUFBSSxDQUFDYSxRQUEzRSxHQUFzRkc7QUFMMUYsTUFsQkosQ0FERjtBQThCRCxHQWpEQSxDQURILENBREYsQ0FERjtBQXdERCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBGcmFnbWVudCwgdXNlQ29udGV4dCB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgSVByb3BzIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xyXG5pbXBvcnQgeyBFZGl0b3JDb250ZXh0LCBQcmV2aWV3VHlwZSwgQ29udGV4dFN0b3JlIH0gZnJvbSAnLi4vLi4vQ29udGV4dCc7XHJcbmltcG9ydCB7IElDb21tYW5kIH0gZnJvbSAnLi4vLi4vY29tbWFuZHMnO1xyXG5pbXBvcnQgQ2hpbGQgZnJvbSAnLi9DaGlsZCc7XHJcbmltcG9ydCAnLi9pbmRleC5sZXNzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVRvb2xiYXJQcm9wcyBleHRlbmRzIElQcm9wcyB7XHJcbiAgaGVpZ2h0PzogUmVhY3QuQ1NTUHJvcGVydGllc1snaGVpZ2h0J107XHJcbiAgb25Db21tYW5kPzogKGNvbW1hbmQ6IElDb21tYW5kPHN0cmluZz4sIGdyb3VwTmFtZT86IHN0cmluZykgPT4gdm9pZDtcclxuICBjb21tYW5kcz86IElDb21tYW5kPHN0cmluZz5bXTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gVG9vbGJhcihwcm9wczogSVRvb2xiYXJQcm9wcyA9IHt9KSB7XHJcbiAgY29uc3QgeyBwcmVmaXhDbHMsIGhlaWdodCA9IDI5IH0gPSBwcm9wcztcclxuICBjb25zdCB7IGNvbW1hbmRzLCBmdWxsc2NyZWVuLCBwcmV2aWV3LCBiYXJQb3B1cCA9IHt9LCBjb21tYW5kT3JjaGVzdHJhdG9yLCBkaXNwYXRjaCB9ID0gdXNlQ29udGV4dChFZGl0b3JDb250ZXh0KTtcclxuICBmdW5jdGlvbiBoYW5kbGVDbGljayhjb21tYW5kOiBJQ29tbWFuZDxzdHJpbmc+LCBuYW1lPzogc3RyaW5nKSB7XHJcbiAgICBpZiAoIWRpc3BhdGNoKSByZXR1cm47XHJcbiAgICBjb25zdCBzdGF0ZTogQ29udGV4dFN0b3JlID0geyBiYXJQb3B1cDogeyAuLi5iYXJQb3B1cCB9IH07XHJcbiAgICBpZiAoY29tbWFuZC5rZXlDb21tYW5kID09PSAncHJldmlldycpIHtcclxuICAgICAgc3RhdGUucHJldmlldyA9IGNvbW1hbmQudmFsdWUgYXMgUHJldmlld1R5cGU7XHJcbiAgICB9XHJcbiAgICBpZiAoY29tbWFuZC5rZXlDb21tYW5kID09PSAnZnVsbHNjcmVlbicpIHtcclxuICAgICAgc3RhdGUuZnVsbHNjcmVlbiA9ICFmdWxsc2NyZWVuO1xyXG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gZnVsbHNjcmVlbiA/ICdpbml0aWFsJyA6ICdoaWRkZW4nO1xyXG4gICAgfVxyXG4gICAgaWYgKGNvbW1hbmRzICYmIGNvbW1hbmQua2V5Q29tbWFuZCA9PT0gJ2dyb3VwJykge1xyXG4gICAgICBjb21tYW5kcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgaWYgKG5hbWUgPT09IGl0ZW0uZ3JvdXBOYW1lKSB7XHJcbiAgICAgICAgICBzdGF0ZS5iYXJQb3B1cCFbbmFtZSFdID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0ua2V5Q29tbWFuZCkge1xyXG4gICAgICAgICAgc3RhdGUuYmFyUG9wdXAhW2l0ZW0uZ3JvdXBOYW1lIV0gPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIGlmIChuYW1lIHx8IGNvbW1hbmQucGFyZW50KSB7XHJcbiAgICAgIE9iamVjdC5rZXlzKHN0YXRlLmJhclBvcHVwIHx8IHt9KS5mb3JFYWNoKChrZXlOYW1lKSA9PiB7XHJcbiAgICAgICAgc3RhdGUuYmFyUG9wdXAhW2tleU5hbWVdID0gZmFsc2U7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChPYmplY3Qua2V5cyhzdGF0ZSkubGVuZ3RoKSB7XHJcbiAgICAgIGRpc3BhdGNoKHsgLi4uc3RhdGUgfSk7XHJcbiAgICB9XHJcbiAgICBjb21tYW5kT3JjaGVzdHJhdG9yICYmIGNvbW1hbmRPcmNoZXN0cmF0b3IuZXhlY3V0ZUNvbW1hbmQoY29tbWFuZCk7XHJcbiAgfVxyXG4gIHJldHVybiAoXHJcbiAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10b29sYmFyYH0gc3R5bGU9e3sgaGVpZ2h0IH19PlxyXG4gICAgICA8dWw+XHJcbiAgICAgICAgeyhwcm9wcy5jb21tYW5kcyB8fCBjb21tYW5kcyB8fCBbXSkubWFwKChpdGVtLCBpZHgpID0+IHtcclxuICAgICAgICAgIGlmIChpdGVtLmtleUNvbW1hbmQgPT09ICdkaXZpZGVyJykge1xyXG4gICAgICAgICAgICByZXR1cm4gPGxpIGtleT17aWR4fSB7Li4uaXRlbS5saVByb3BzfSBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdG9vbGJhci1kaXZpZGVyYH0gLz47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoIWl0ZW0ua2V5Q29tbWFuZCkgcmV0dXJuIDxGcmFnbWVudCAvPjtcclxuICAgICAgICAgIGNvbnN0IGFjdGl2ZUJ0biA9XHJcbiAgICAgICAgICAgIChmdWxsc2NyZWVuICYmIGl0ZW0ua2V5Q29tbWFuZCA9PT0gJ2Z1bGxzY3JlZW4nKSB8fFxyXG4gICAgICAgICAgICAoaXRlbS5rZXlDb21tYW5kID09PSAncHJldmlldycgJiYgcHJldmlldyA9PT0gaXRlbS52YWx1ZSk7XHJcbiAgICAgICAgICBjb25zdCBjaGlsZE5vZGUgPVxyXG4gICAgICAgICAgICB0eXBlb2YgaXRlbS5jaGlsZHJlbiA9PT0gJ2Z1bmN0aW9uJ1xyXG4gICAgICAgICAgICAgID8gaXRlbS5jaGlsZHJlbih7XHJcbiAgICAgICAgICAgICAgICAgIGdldFN0YXRlOiAoKSA9PiBjb21tYW5kT3JjaGVzdHJhdG9yIS5nZXRTdGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAgICB0ZXh0QXBpOiBjb21tYW5kT3JjaGVzdHJhdG9yID8gY29tbWFuZE9yY2hlc3RyYXRvciEudGV4dEFwaSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgICAgY2xvc2U6ICgpID0+IGhhbmRsZUNsaWNrKHt9LCBpdGVtLmdyb3VwTmFtZSksXHJcbiAgICAgICAgICAgICAgICAgIGV4ZWN1dGU6ICgpID0+IGhhbmRsZUNsaWNrKHsgZXhlY3V0ZTogaXRlbS5leGVjdXRlIH0pLFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcclxuICAgICAgICAgIGNvbnN0IGRpc2FibGVkID1cclxuICAgICAgICAgICAgYmFyUG9wdXAgJiYgcHJldmlldyAmJiBwcmV2aWV3ID09PSAncHJldmlldycgJiYgIS8ocHJldmlld3xmdWxsc2NyZWVuKS8udGVzdChpdGVtLmtleUNvbW1hbmQpO1xyXG4gICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPGxpIGtleT17aWR4fSB7Li4uaXRlbS5saVByb3BzfSBjbGFzc05hbWU9e2FjdGl2ZUJ0biA/IGBhY3RpdmVgIDogJyd9PlxyXG4gICAgICAgICAgICAgIHshaXRlbS5idXR0b25Qcm9wcyAmJiBpdGVtLmljb259XHJcbiAgICAgICAgICAgICAge2l0ZW0uYnV0dG9uUHJvcHMgJiZcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXHJcbiAgICAgICAgICAgICAgICAgICdidXR0b24nLFxyXG4gICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2RhdGEtbmFtZSc6IGl0ZW0ubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAuLi5pdGVtLmJ1dHRvblByb3BzLFxyXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IChldm46IFJlYWN0Lk1vdXNlRXZlbnQ8SFRNTEJ1dHRvbkVsZW1lbnQsIE1vdXNlRXZlbnQ+KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBldm4uc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVDbGljayhpdGVtLCBpdGVtLmdyb3VwTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgaXRlbS5pY29uLFxyXG4gICAgICAgICAgICAgICAgKX1cclxuICAgICAgICAgICAgICB7aXRlbS5jaGlsZHJlbiAmJiAoXHJcbiAgICAgICAgICAgICAgICA8Q2hpbGRcclxuICAgICAgICAgICAgICAgICAgZ3JvdXBOYW1lPXtpdGVtLmdyb3VwTmFtZX1cclxuICAgICAgICAgICAgICAgICAgcHJlZml4Q2xzPXtwcmVmaXhDbHN9XHJcbiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuPXtjaGlsZE5vZGV9XHJcbiAgICAgICAgICAgICAgICAgIGNvbW1hbmRzPXtcclxuICAgICAgICAgICAgICAgICAgICBBcnJheS5pc0FycmF5KGl0ZW0uY2hpbGRyZW4pICYmIHR5cGVvZiBpdGVtLmNoaWxkcmVuICE9PSAnZnVuY3Rpb24nID8gaXRlbS5jaGlsZHJlbiA6IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICl9XHJcbiAgICAgICAgICAgIDwvbGk+XHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0pfVxyXG4gICAgICA8L3VsPlxyXG4gICAgPC9kaXY+XHJcbiAgKTtcclxufVxyXG4iXX0=